<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>ไวรัสโคโรนา 2019 (COVID-19)</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src="https://api.mapbox.com/mapbox-gl-js/v1.9.1/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v1.9.1/mapbox-gl.css" rel="stylesheet" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src="https://api.mapbox.com/mapbox-gl-js/v1.9.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v1.9.0/mapbox-gl.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
</head>
<style>
	body { margin: 0; padding: 0; }
	#map { position: absolute; top: 0; bottom: 0; width: 100%; }
  * {
  box-sizing: border-box;
}
#panel {
			position: absolute;
			top: 10px;
			left: 50px;
		}
.btn-map {
			height: 40px;
			background: #7b98bc;
			color: white;
			border: 2px solid white;
			border-radius: 4px;
			font-size: 14px;
			opacity: 0.9;
			font-weight: bold;
		}
  .column {
  float: left;
  width: 50%;
  padding: 10px;
  height: 300px; /* Should be removed. Only for demonstration */
}
.column2 {
  float: left;
  width: 50%;
  padding: 10px;
  height: 150px; /* Should be removed. Only for demonstration */
}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}
  #menu {
  background: #fff;
  position: absolute;
  z-index: 1;
  top: 10px;
  right: 10px;
  border-radius: 3px;
  width: 120px;
  border: 1px solid rgba(0, 0, 0, 0.4);
  font-family: 'Open Sans', sans-serif;
  }
  
  #menu a {
  font-size: 13px;
  color: #404040;
  display: block;
  margin: 0;
  padding: 0;
  padding: 10px;
  text-decoration: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.25);
  text-align: center;
  }
  
  #menu a:last-child {
  border: none;
  }
  
  #menu a:hover {
  background-color: #f8f8f8;
  color: #404040;
  }
  
  #menu a.active {
  background-color: #3887be;
  color: #ffffff;
  }
  
  #menu a.active:hover {
  background: #3074a4;
  }

</style>
<body>
<nav id="menu"></nav>
<div id="map"></div>
<div id="panel">
  <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal">COVID-19</button>
  <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal2">ประเทศไทย</button>
</div>
<div class="container">

  <!-- Modal -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">สถานการณ์ COVID-19</h4>
          <p>ข้อมูลสะสมทั่วโลก</p>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="column2">
              <p><div class="mypanel-10"></div></p>
              <p><div class="mypanel-10"></div></p>
              <p><div class="mypanel-10"></div></p>
            </div>
            <div class="column2">
              <p><div class="mypanel-7"></div></p>
              <p><div class="mypanel-8"></div></p>
              <p><div class="mypanel-9"></div></p>
            </div>
            <p align = 'right'> ข้อมูลจาก : Johns Hopkins University &nbsp;&nbsp;&nbsp;</p>
            <p align = 'right'> <a target="_blank" href="https://github.com/CSSEGISandData">https://github.com/CSSEGISandData</a> &nbsp;&nbsp;&nbsp;</p>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>
</div>

<div class="container">

  <!-- Modal -->
  <div class="modal fade" id="myModal2" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">สถานการณ์ COVID-19 ในประเทศไทย</h4>
          <p>ข้อมูลสะสมในแต่ละวัน</p>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="column">
              <p><div class="mypanel-6"></div></p>
              <p><div class="mypanel-4"></div></p>
              <p><div class="mypanel-2"></div></p>
            </div>
            <div class="column">
              <p><div class="mypanel-5"></div></p>
              <p><div class="mypanel-3"></div></p>
              <p><div class="mypanel-1"></div></p>
            </div>
            <!-- <p align = 'right'> แผนที่ข้อมูลรายจังหวัด &nbsp;&nbsp;&nbsp;</p> -->
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>
  
</div>

<script>
  $.getJSON('https://kathumap.i-bitz.co.th/geoserver/KathuMap/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=KathuMap%3Acorona-total-thai&maxFeatures=50&outputFormat=application%2Fjson', function(data) {
        
        var text = `วันที่ : ${data.features[0].properties.Date}<br>
                    ผู้ป่วยสะสม : ${data.features[0].properties.total} คน<br>
                    เสียชีวิต : ${data.features[0].properties.death} คน<br>
                    รักษาหาย : ${data.features[0].properties.recove} คน`
                    
        
        $(".mypanel-1").html(text);
    });
    $.getJSON('https://kathumap.i-bitz.co.th/geoserver/KathuMap/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=KathuMap%3Acorona-total-thai&maxFeatures=50&outputFormat=application%2Fjson', function(data) {
        
        var text = `วันที่ : ${data.features[1].properties.Date}<br>
                    ผู้ป่วยสะสม : ${data.features[1].properties.total} คน<br>
                    เสียชีวิต : ${data.features[1].properties.death} คน<br>
                    รักษาหาย : ${data.features[1].properties.recove} คน`
                    
        
        $(".mypanel-2").html(text);
    });

    $.getJSON('https://kathumap.i-bitz.co.th/geoserver/KathuMap/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=KathuMap%3Acorona-total-thai&maxFeatures=50&outputFormat=application%2Fjson', function(data) {
        
        var text = `วันที่ : ${data.features[2].properties.Date}<br>
                    ผู้ป่วยสะสม : ${data.features[2].properties.total} คน<br>
                    เสียชีวิต : ${data.features[2].properties.death} คน<br>
                    รักษาหาย : ${data.features[2].properties.recove} คน`
                    
        
        $(".mypanel-3").html(text);
    });

    $.getJSON('https://kathumap.i-bitz.co.th/geoserver/KathuMap/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=KathuMap%3Acorona-total-thai&maxFeatures=50&outputFormat=application%2Fjson', function(data) {
        
        var text = `วันที่ : ${data.features[3].properties.Date}<br>
                    ผู้ป่วยสะสม : ${data.features[3].properties.total} คน<br>
                    เสียชีวิต : ${data.features[3].properties.death} คน<br>
                    รักษาหาย : ${data.features[3].properties.recove} คน`
                    
        
        $(".mypanel-4").html(text);
    });

    $.getJSON('https://kathumap.i-bitz.co.th/geoserver/KathuMap/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=KathuMap%3Acorona-total-thai&maxFeatures=50&outputFormat=application%2Fjson', function(data) {
        
        var text = `วันที่ : ${data.features[4].properties.Date}<br>
                    ผู้ป่วยสะสม : ${data.features[4].properties.total} คน<br>
                    เสียชีวิต : ${data.features[4].properties.death} คน<br>
                    รักษาหาย : ${data.features[4].properties.recove} คน`
                    
        
        $(".mypanel-5").html(text);
    });

    $.getJSON('https://kathumap.i-bitz.co.th/geoserver/KathuMap/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=KathuMap%3Acorona-total-thai&maxFeatures=50&outputFormat=application%2Fjson', function(data) {
        
        var text = `วันที่ : ${data.features[5].properties.Date} <br>
                    ผู้ป่วยสะสม : ${data.features[5].properties.total} คน<br>
                    เสียชีวิต : ${data.features[5].properties.death} คน<br>
                    รักษาหาย : ${data.features[5].properties.recove} คน`
                    
        
        $(".mypanel-6").html(text);
    });

    $.getJSON('https://kathumap.i-bitz.co.th/geoserver/KathuMap/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=KathuMap%3Acorona-total-global&maxFeatures=50&outputFormat=application%2Fjson', function(data) {
        
        var text = `ผู้ป่วยสะสม : ${data.features[0].properties.total} คน`
                    
        
        $(".mypanel-7").html(text);
    });

    $.getJSON('https://kathumap.i-bitz.co.th/geoserver/KathuMap/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=KathuMap%3Acorona-total-global&maxFeatures=50&outputFormat=application%2Fjson', function(data) {
        
        var text = `เสียชีวิต : ${data.features[0].properties.death}`
                    
        
        $(".mypanel-8").html(text);
    });

    $.getJSON('https://kathumap.i-bitz.co.th/geoserver/KathuMap/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=KathuMap%3Acorona-total-global&maxFeatures=50&outputFormat=application%2Fjson', function(data) {
        
        var text = `รักษาหาย : ${data.features[0].properties.recover} คน`
                    
        
        $(".mypanel-9").html(text);
    });

    $.getJSON('https://kathumap.i-bitz.co.th/geoserver/KathuMap/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=KathuMap%3Acorona-total-thai&maxFeatures=50&outputFormat=application%2Fjson', function(data) {
        
        var text = `วันที่ : ${data.features[5].properties.Date}`
                    
        
        $(".mypanel-10").html(text);
    });


	mapboxgl.accessToken = 'pk.eyJ1Ijoic2F0dGF3YXRhcmFiIiwiYSI6ImNpcjMxN3cxcTAwMXFmam5tNGtuY2VjbXcifQ.oQVD5NNye6tRSqiORiLRCw';
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/light-v10',
        center: [100.04, 10.907],
        zoom: 2
    });

    map.on('load', function() {
        // Add a source for the state polygons.
        map.addSource('states', {
        type: 'geojson',
        data: 'https://kathumap.i-bitz.co.th/geoserver/KathuMap/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=KathuMap%3Acorona&outputFormat=application%2Fjson'
        }
        ),
        map.addSource('states1', {
        type: 'geojson',
        data: 'https://kathumap.i-bitz.co.th/geoserver/KathuMap/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=KathuMap%3Acorona&outputFormat=application%2Fjson'
        }),
        map.addSource('states2', {
        type: 'geojson',
        data: 'https://kathumap.i-bitz.co.th/geoserver/KathuMap/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=KathuMap%3Acorona&outputFormat=application%2Fjson'
        }),
        map.addSource('states3', {
        type: 'geojson',
        data: 'https://kathumap.i-bitz.co.th/geoserver/KathuMap/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=KathuMap%3Acorona&outputFormat=application%2Fjson'
        }),
        map.addSource('states4', {
        type: 'geojson',
        data: 'https://kathumap.i-bitz.co.th/geoserver/KathuMap/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=KathuMap%3Acorona&outputFormat=application%2Fjson'
        }),
        map.addSource('states5', {
        type: 'geojson',
        data: 'https://kathumap.i-bitz.co.th/geoserver/KathuMap/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=KathuMap%3Acorona&outputFormat=application%2Fjson'
        });
        

        // Add a layer showing the state polygons.
       map.addLayer(
            // 'id': 'states-layer',
            // 'type': 'fill',
            // 'source': 'states',
            // 'paint': {
            //     'fill-color': 'rgba(200, 100, 240, 0.4)',
            //     'fill-outline-color': 'rgba(200, 100, 240, 1)'
            // }
            
            {'id': 'states-layer',
            'type': 'circle',
            'source': 'states',
            'paint': {'circle-radius': 10,'circle-color': 'rgba(200, 100, 240, 0.0)'},
            'filter': ["all", [">=", "total", 1]],
            }
    ),
      map.addLayer(
            {'id': 'sum <= 50',
            'type': 'circle',
            'source': 'states1',
            'paint': {'circle-radius': 5,'circle-color': 'rgba(200, 100, 240, 0.5)'},
            'filter': ["all", [">", "total", 1], ["<=", "total", 50]],}
      ),
      map.addLayer(
            {'id': 'sum 51-500',
            'type': 'circle',
            'source': 'states2',
            'paint': {'circle-radius': 12,'circle-color': 'rgba(200, 100, 240, 0.6)'},
            'filter': ["all", [">", "total", 50], ["<=", "total", 500]],}
    ),
    map.addLayer(
            {'id': 'sum 501-5k',
            'type': 'circle',
            'source': 'states3',
            'paint': {'circle-radius': 18,'circle-color': 'rgba(200, 100, 240, 0.7)'},
            'filter': ["all", [">", "total", 500], ["<=", "total", 5000]],}
    ),
    map.addLayer(
            {'id': 'sum 5k-50k',
            'type': 'circle',
            'source': 'states4',
            'paint': {'circle-radius': 24,'circle-color': 'rgba(200, 100, 240, 0.7)'},
            'filter': ["all", [">", "total", 5000], ["<=", "total", 50000]],}
    ),
    map.addLayer(
            {'id': 'sum > 50k',
            'type': 'circle',
            'source': 'states5',
            'paint': {'circle-radius': 28,'circle-color': 'rgba(200, 100, 240, 0.8)'},
            'filter': ["all", [">", "total", 50000]],}
    );

        // When a click event occurs on a feature in the states layer, open a popup at the
        // location of the click, with description HTML from its properties.
        map.on('click', 'states-layer', function(e) {
            new mapboxgl.Popup()
                .setLngLat(e.lngLat)
                .setHTML('<b>จำนวนผู้ป่วย : </b> ' +e.features[0].properties.total +'<b> คน</b>'
                  + '<br/>' +'<b>เสียชีวิต : </b>' +e.features[0].properties.ideath +'<b> คน</b>'
                  + '<br/>' +'<b>รักษาหาย : </b>' +e.features[0].properties.recover +'<b> คน</b>'
                  + '<br/>' +'<b>เมือง : </b>' +e.features[0].properties.Province
                  + '<br/>' +'<b>ประเทศ : </b>' +e.features[0].properties.Country)
                .addTo(map);
        });

        // Change the cursor to a pointer when the mouse is over the states layer.
        map.on('mouseenter', 'states-layer', function() {
            map.getCanvas().style.cursor = 'pointer';
        });

        // Change it back to a pointer when it leaves.
        map.on('mouseleave', 'states-layer', function() {
            map.getCanvas().style.cursor = '';
        });
    


    var toggleableLayerIds = ['sum <= 50','sum 51-500','sum 501-5k','sum 5k-50k', 'sum > 50k'];
  
    for (var i = 0; i < toggleableLayerIds.length; i++) {
        var id = toggleableLayerIds[i];
        
        var link = document.createElement('a');
        link.href = '#';
        link.className = 'active';
        link.textContent = id;
        
        link.onclick = function(e) {
          var clickedLayer = this.textContent;
          e.preventDefault();
          e.stopPropagation();
          
          var visibility = map.getLayoutProperty(clickedLayer, 'visibility');
          
          if (visibility === 'visible') {
          map.setLayoutProperty(clickedLayer, 'visibility', 'none');
          this.className = '';
          } 
          else {
          this.className = 'active';
          map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
          }
        };
        
        var layers = document.getElementById('menu');
        layers.appendChild(link);
    }

  });
</script>

</body>
</html>
